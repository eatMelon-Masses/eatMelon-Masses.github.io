---
layout: post
title:  "grpc基础教程"
date:    2021-02-18 10:57:39 +0800
categories: grpc基础
tag: grpc基础
---

* content
{:toc}

## 定义服务
我们需要指定路径，用来存放通过proto脚本生成的java代码
```
option java_package = "io.grpc.examples.routeguide";
```
如果要定义一个服务我们在.proto使用service关键字
```
service RouteGuide {
    ...
}
```
定义rpc方法，定义传输的request 和 reponse对象。
##  几种服务方法
- 一个简单的rpc调用，客户端发送一个消息到服务端，服务端收到请求后，包装响应信息，返回结果。
```
// Obtains the feature at a given position.
rpc GetFeature(Point) returns (Feature) {}
```
- 一个服务端流处理rpc调用，客户端发送一个消息到服务端，服务端收到消息后，得到一个流，向客户端连续发送一个或者多个响应，客户端读取所有服务端的响应后进行逻辑处理。

```
// Obtains the Features available within the given Rectangle.  Results are
// streamed rather than returned at once (e.g. in a response message with a
// repeated field), as the rectangle may cover a large area and contain a
// huge number of features.
rpc ListFeatures(Rectangle) returns (stream Feature) {}
```

- 一个客户端流处理 rpc调用，客户端通过流发送一连串有序的消息到服务端，如果客户端发送完所有消息后，便等待服务端去读取他们和返回多个响应。当服务端连续读取信息，直到没有更多的消息后，进行逻辑处理，返回响应信息。

```
// Accepts a stream of Points on a route being traversed, returning a
// RouteSummary when traversal is completed.
rpc RecordRoute(stream Point) returns (RouteSummary) {}
```
- 一个客户端和服务端都是用流传输的rpc调用，如果客户端完成消息写入，它等待服务器读取所有消息，然后返回他们的响应。
```
// Accepts a stream of RouteNotes sent while a route is being traversed,
// while receiving other RouteNotes (e.g. from other users).
rpc RouteChat(stream RouteNote) returns (stream RouteNote) {}
```


## 生成客户端和服务端代码
   我们需要生成grpc客户端和服务端接口通过.proto 服务定义。我们使用协议缓冲编译器protoc 和指定的jrpc java plugin。
   当使用gradle or maven， the protoc 构建 插件能够生成需要的代码在构建阶段。
### 如何用maven 编译 .proto 脚本生成代码
## 创建服务